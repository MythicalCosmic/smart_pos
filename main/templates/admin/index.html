{% extends 'admin/base.html' %}
{% load i18n unfold %}

{% block content %}
<style>
    @import url('https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@400;500;600;700;800&display=swap');
    
    :root {
        --primary: #6366f1;
        --primary-light: #818cf8;
        --emerald: #10b981;
        --amber: #f59e0b;
        --rose: #f43f5e;
        --violet: #8b5cf6;
        --cyan: #06b6d4;
        --glass-bg: rgba(255, 255, 255, 0.03);
        --glass-border: rgba(255, 255, 255, 0.08);
        --card-shadow: 0 4px 24px -4px rgba(0, 0, 0, 0.2);
        --glow-primary: 0 0 40px rgba(99, 102, 241, 0.15);
    }
    
    .dashboard-container {
        font-family: 'Plus Jakarta Sans', sans-serif;
        padding: 0;
        min-height: 100vh;
    }
    
    .dashboard-bg {
        position: fixed;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background: 
            radial-gradient(ellipse at 20% 20%, rgba(99, 102, 241, 0.08) 0%, transparent 50%),
            radial-gradient(ellipse at 80% 80%, rgba(16, 185, 129, 0.06) 0%, transparent 50%),
            radial-gradient(ellipse at 40% 60%, rgba(139, 92, 246, 0.05) 0%, transparent 40%);
        pointer-events: none;
        z-index: 0;
    }
    
    .dashboard-content {
        position: relative;
        z-index: 1;
    }
    
    .dashboard-header {
        background: linear-gradient(135deg, rgba(99, 102, 241, 0.1) 0%, rgba(139, 92, 246, 0.05) 100%);
        border-bottom: 1px solid var(--glass-border);
        padding: 1.5rem 2rem;
        margin: -1rem -1rem 2rem -1rem;
        backdrop-filter: blur(20px);
    }
    
    .header-title {
        font-size: 2rem;
        font-weight: 800;
        background: linear-gradient(135deg, #fff 0%, #c7d2fe 100%);
        -webkit-background-clip: text;
        -webkit-text-fill-color: transparent;
        background-clip: text;
        margin-bottom: 0.25rem;
        letter-spacing: -0.02em;
    }
    
    .header-subtitle {
        color: #94a3b8;
        font-size: 0.875rem;
        display: flex;
        align-items: center;
        gap: 0.5rem;
    }
    
    .timezone-badge {
        background: rgba(99, 102, 241, 0.2);
        color: #a5b4fc;
        padding: 0.25rem 0.75rem;
        border-radius: 9999px;
        font-size: 0.75rem;
        font-weight: 600;
    }
    
    .filter-bar {
        display: flex;
        flex-wrap: wrap;
        align-items: center;
        gap: 1rem;
        padding: 1rem 1.5rem;
        background: var(--glass-bg);
        border: 1px solid var(--glass-border);
        border-radius: 16px;
        margin-bottom: 1.5rem;
        backdrop-filter: blur(10px);
    }
    
    .filter-group {
        display: flex;
        gap: 0.25rem;
        background: rgba(0, 0, 0, 0.2);
        border-radius: 12px;
        padding: 0.25rem;
    }
    
    .filter-btn {
        padding: 0.5rem 1rem;
        border-radius: 10px;
        font-size: 0.8125rem;
        font-weight: 600;
        text-decoration: none;
        color: #94a3b8;
        transition: all 0.2s ease;
        display: flex;
        align-items: center;
        gap: 0.375rem;
        border: none;
        background: transparent;
        cursor: pointer;
    }
    
    .filter-btn:hover {
        color: #fff;
        background: rgba(255, 255, 255, 0.05);
    }
    
    .filter-btn.active {
        background: linear-gradient(135deg, var(--primary) 0%, var(--violet) 100%);
        color: #fff;
        box-shadow: 0 4px 12px rgba(99, 102, 241, 0.4);
    }
    
    .filter-btn .material-symbols-outlined {
        font-size: 1rem;
    }
    
    .filter-divider {
        width: 1px;
        height: 2rem;
        background: var(--glass-border);
    }
    
    .date-inputs {
        display: flex;
        align-items: center;
        gap: 0.5rem;
        flex-wrap: wrap;
    }
    
    .date-input-group {
        display: flex;
        align-items: center;
        gap: 0.25rem;
    }
    
    .date-input-group label {
        font-size: 0.75rem;
        color: #64748b;
        font-weight: 500;
    }
    
    .date-input {
        padding: 0.5rem 0.75rem;
        border-radius: 8px;
        border: 1px solid var(--glass-border);
        background: rgba(0, 0, 0, 0.3);
        color: #fff;
        font-size: 0.8125rem;
        font-family: inherit;
        transition: all 0.2s ease;
    }
    
    .date-input:focus {
        outline: none;
        border-color: var(--primary);
        box-shadow: 0 0 0 3px rgba(99, 102, 241, 0.2);
    }
    
    .date-input[type="date"] { width: 130px; }
    .date-input[type="time"] { width: 100px; }
    
    .clear-btn {
        padding: 0.5rem;
        border-radius: 8px;
        background: rgba(244, 63, 94, 0.2);
        color: #fb7185;
        border: none;
        cursor: pointer;
        display: flex;
        align-items: center;
        justify-content: center;
        transition: all 0.2s ease;
        text-decoration: none;
    }
    
    .clear-btn:hover {
        background: rgba(244, 63, 94, 0.3);
    }
    
    .period-display {
        display: inline-flex;
        align-items: center;
        gap: 0.75rem;
        padding: 0.75rem 1.25rem;
        background: linear-gradient(135deg, rgba(99, 102, 241, 0.15) 0%, rgba(139, 92, 246, 0.1) 100%);
        border: 1px solid rgba(99, 102, 241, 0.3);
        border-radius: 12px;
        margin-bottom: 1.5rem;
    }
    
    .period-display .material-symbols-outlined {
        color: var(--primary-light);
    }
    
    .period-label {
        font-size: 0.875rem;
        font-weight: 600;
        color: #c7d2fe;
    }
    
    .kpi-grid {
        display: grid;
        grid-template-columns: repeat(4, 1fr);
        gap: 1.25rem;
        margin-bottom: 1.5rem;
    }
    
    @media (max-width: 1200px) {
        .kpi-grid { grid-template-columns: repeat(2, 1fr); }
    }
    
    @media (max-width: 640px) {
        .kpi-grid { grid-template-columns: 1fr; }
    }
    
    .kpi-card {
        background: var(--glass-bg);
        border: 1px solid var(--glass-border);
        border-radius: 20px;
        padding: 1.5rem;
        position: relative;
        overflow: hidden;
        transition: all 0.3s ease;
        animation: slideUp 0.6s ease forwards;
        opacity: 0;
        transform: translateY(20px);
    }
    
    .kpi-card:nth-child(1) { animation-delay: 0.1s; }
    .kpi-card:nth-child(2) { animation-delay: 0.2s; }
    .kpi-card:nth-child(3) { animation-delay: 0.3s; }
    .kpi-card:nth-child(4) { animation-delay: 0.4s; }
    
    @keyframes slideUp {
        to {
            opacity: 1;
            transform: translateY(0);
        }
    }
    
    .kpi-card:hover {
        transform: translateY(-4px);
        border-color: rgba(99, 102, 241, 0.3);
        box-shadow: var(--glow-primary);
    }
    
    .kpi-card::before {
        content: '';
        position: absolute;
        top: 0;
        left: 0;
        right: 0;
        height: 3px;
        border-radius: 20px 20px 0 0;
    }
    
    .kpi-card.emerald::before { background: linear-gradient(90deg, #10b981, #34d399); }
    .kpi-card.blue::before { background: linear-gradient(90deg, #3b82f6, #60a5fa); }
    .kpi-card.violet::before { background: linear-gradient(90deg, #8b5cf6, #a78bfa); }
    .kpi-card.amber::before { background: linear-gradient(90deg, #f59e0b, #fbbf24); }
    
    .kpi-header {
        display: flex;
        justify-content: space-between;
        align-items: flex-start;
        margin-bottom: 1rem;
    }
    
    .kpi-title {
        font-size: 0.8125rem;
        color: #94a3b8;
        font-weight: 500;
        text-transform: uppercase;
        letter-spacing: 0.05em;
    }
    
    .kpi-icon {
        width: 48px;
        height: 48px;
        border-radius: 14px;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 1.5rem;
    }
    
    .kpi-card.emerald .kpi-icon { background: rgba(16, 185, 129, 0.15); color: #34d399; }
    .kpi-card.blue .kpi-icon { background: rgba(59, 130, 246, 0.15); color: #60a5fa; }
    .kpi-card.violet .kpi-icon { background: rgba(139, 92, 246, 0.15); color: #a78bfa; }
    .kpi-card.amber .kpi-icon { background: rgba(245, 158, 11, 0.15); color: #fbbf24; }
    
    .kpi-value {
        font-size: 2rem;
        font-weight: 800;
        color: #fff;
        line-height: 1;
        margin-bottom: 0.25rem;
        letter-spacing: -0.02em;
    }
    
    .kpi-unit {
        font-size: 1rem;
        font-weight: 600;
        color: #64748b;
        margin-left: 0.25rem;
    }
    
    .kpi-footer {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-top: 0.75rem;
    }
    
    .kpi-period {
        font-size: 0.75rem;
        color: #64748b;
    }
    
    .kpi-growth {
        display: flex;
        align-items: center;
        gap: 0.25rem;
        font-size: 0.75rem;
        font-weight: 600;
        padding: 0.25rem 0.5rem;
        border-radius: 6px;
    }
    
    .kpi-growth.positive {
        background: rgba(16, 185, 129, 0.15);
        color: #34d399;
    }
    
    .kpi-growth.negative {
        background: rgba(244, 63, 94, 0.15);
        color: #fb7185;
    }
    
    .kpi-growth .material-symbols-outlined {
        font-size: 0.875rem;
    }
    
    .status-row {
        display: grid;
        grid-template-columns: repeat(5, 1fr);
        gap: 1rem;
        margin-bottom: 1.5rem;
    }
    
    @media (max-width: 1024px) {
        .status-row { grid-template-columns: repeat(3, 1fr); }
    }
    
    @media (max-width: 640px) {
        .status-row { grid-template-columns: repeat(2, 1fr); }
    }
    
    .status-card {
        background: var(--glass-bg);
        border: 1px solid var(--glass-border);
        border-radius: 16px;
        padding: 1.25rem;
        text-align: center;
        transition: all 0.3s ease;
        animation: scaleIn 0.5s ease forwards;
        opacity: 0;
        transform: scale(0.9);
    }
    
    .status-card:nth-child(1) { animation-delay: 0.2s; }
    .status-card:nth-child(2) { animation-delay: 0.25s; }
    .status-card:nth-child(3) { animation-delay: 0.3s; }
    .status-card:nth-child(4) { animation-delay: 0.35s; }
    .status-card:nth-child(5) { animation-delay: 0.4s; }
    
    @keyframes scaleIn {
        to {
            opacity: 1;
            transform: scale(1);
        }
    }
    
    .status-card:hover {
        transform: scale(1.02);
        border-color: rgba(255, 255, 255, 0.15);
    }
    
    .status-icon {
        width: 40px;
        height: 40px;
        border-radius: 10px;
        display: flex;
        align-items: center;
        justify-content: center;
        margin: 0 auto 0.75rem;
        font-size: 1.25rem;
    }
    
    .status-card.blue .status-icon { background: rgba(59, 130, 246, 0.15); color: #60a5fa; }
    .status-card.orange .status-icon { background: rgba(249, 115, 22, 0.15); color: #fb923c; }
    .status-card.amber .status-icon { background: rgba(245, 158, 11, 0.15); color: #fbbf24; }
    .status-card.green .status-icon { background: rgba(16, 185, 129, 0.15); color: #34d399; }
    .status-card.red .status-icon { background: rgba(244, 63, 94, 0.15); color: #fb7185; }
    
    .status-count {
        font-size: 1.75rem;
        font-weight: 800;
        margin-bottom: 0.25rem;
    }
    
    .status-card.blue .status-count { color: #60a5fa; }
    .status-card.orange .status-count { color: #fb923c; }
    .status-card.amber .status-count { color: #fbbf24; }
    .status-card.green .status-count { color: #34d399; }
    .status-card.red .status-count { color: #fb7185; }
    
    .status-label {
        font-size: 0.75rem;
        color: #94a3b8;
        font-weight: 500;
        text-transform: uppercase;
        letter-spacing: 0.05em;
    }
    
    .chart-grid {
        display: grid;
        grid-template-columns: repeat(2, 1fr);
        gap: 1.5rem;
        margin-bottom: 1.5rem;
    }
    
    @media (max-width: 1024px) {
        .chart-grid { grid-template-columns: 1fr; }
    }
    
    .chart-card {
        background: var(--glass-bg);
        border: 1px solid var(--glass-border);
        border-radius: 20px;
        padding: 1.5rem;
        animation: fadeIn 0.6s ease forwards;
        opacity: 0;
    }
    
    .chart-card:nth-child(1) { animation-delay: 0.3s; }
    .chart-card:nth-child(2) { animation-delay: 0.4s; }
    
    @keyframes fadeIn {
        to { opacity: 1; }
    }
    
    .chart-card.full-width {
        grid-column: 1 / -1;
    }
    
    .chart-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 1.25rem;
    }
    
    .chart-title {
        font-size: 1.125rem;
        font-weight: 700;
        color: #fff;
        display: flex;
        align-items: center;
        gap: 0.5rem;
    }
    
    .chart-title .material-symbols-outlined {
        font-size: 1.25rem;
        color: var(--primary-light);
    }
    
    .chart-badge {
        padding: 0.375rem 0.75rem;
        border-radius: 8px;
        font-size: 0.75rem;
        font-weight: 600;
    }
    
    .chart-badge.emerald {
        background: rgba(16, 185, 129, 0.15);
        color: #34d399;
    }
    
    .chart-badge.blue {
        background: rgba(59, 130, 246, 0.15);
        color: #60a5fa;
    }
    
    .chart-badge.violet {
        background: rgba(139, 92, 246, 0.15);
        color: #a78bfa;
    }
    
    .chart-container {
        position: relative;
        height: 280px;
    }
    
    .chart-container.pie {
        height: 280px;
        display: flex;
        align-items: center;
        justify-content: center;
    }
    
    .pie-legend {
        display: grid;
        grid-template-columns: repeat(2, 1fr);
        gap: 0.5rem;
        margin-top: 1rem;
    }
    
    .legend-item {
        display: flex;
        align-items: center;
        gap: 0.5rem;
        padding: 0.5rem 0.75rem;
        background: rgba(0, 0, 0, 0.2);
        border-radius: 8px;
        font-size: 0.8125rem;
    }
    
    .legend-color {
        width: 12px;
        height: 12px;
        border-radius: 4px;
        flex-shrink: 0;
    }
    
    .legend-label {
        color: #94a3b8;
        flex: 1;
        white-space: nowrap;
        overflow: hidden;
        text-overflow: ellipsis;
    }
    
    .legend-value {
        font-weight: 700;
        color: #fff;
    }
    
    .three-col-grid {
        display: grid;
        grid-template-columns: repeat(3, 1fr);
        gap: 1.5rem;
        margin-bottom: 1.5rem;
    }
    
    @media (max-width: 1200px) {
        .three-col-grid { grid-template-columns: 1fr; }
    }
    
    .data-table {
        width: 100%;
    }
    
    .table-row {
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: 0.875rem 0;
        border-bottom: 1px solid var(--glass-border);
    }
    
    .table-row:last-child {
        border-bottom: none;
    }
    
    .table-row:hover {
        background: rgba(255, 255, 255, 0.02);
        margin: 0 -1rem;
        padding-left: 1rem;
        padding-right: 1rem;
        border-radius: 8px;
    }
    
    .table-main {
        flex: 1;
    }
    
    .table-title {
        font-weight: 600;
        color: #fff;
        font-size: 0.875rem;
        margin-bottom: 0.125rem;
    }
    
    .table-subtitle {
        font-size: 0.75rem;
        color: #64748b;
    }
    
    .table-value {
        font-weight: 700;
        font-size: 0.875rem;
    }
    
    .table-value.emerald { color: #34d399; }
    .table-value.blue { color: #60a5fa; }
    .table-value.violet { color: #a78bfa; }
    .table-value.amber { color: #fbbf24; }
    
    .cashier-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        flex-wrap: wrap;
        gap: 1rem;
        margin-bottom: 1.25rem;
    }
    
    .cashier-select {
        padding: 0.5rem 1rem;
        border-radius: 10px;
        border: 1px solid var(--glass-border);
        background: rgba(0, 0, 0, 0.3);
        color: #fff;
        font-size: 0.8125rem;
        font-family: inherit;
        min-width: 200px;
    }
    
    .cashier-select:focus {
        outline: none;
        border-color: var(--primary);
    }
    
    .cashier-card {
        background: linear-gradient(135deg, rgba(139, 92, 246, 0.1) 0%, rgba(99, 102, 241, 0.05) 100%);
        border: 1px solid rgba(139, 92, 246, 0.2);
        border-radius: 16px;
        padding: 1.25rem;
        margin-bottom: 1rem;
        display: flex;
        align-items: center;
        gap: 1rem;
    }
    
    .cashier-avatar {
        width: 56px;
        height: 56px;
        border-radius: 14px;
        background: linear-gradient(135deg, var(--violet) 0%, var(--primary) 100%);
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 1.5rem;
        font-weight: 700;
        color: #fff;
    }
    
    .cashier-info {
        flex: 1;
    }
    
    .cashier-name {
        font-size: 1.125rem;
        font-weight: 700;
        color: #fff;
        margin-bottom: 0.25rem;
    }
    
    .cashier-role {
        font-size: 0.75rem;
        color: #a78bfa;
        text-transform: uppercase;
        letter-spacing: 0.05em;
    }
    
    .cashier-stats {
        display: flex;
        gap: 1.5rem;
    }
    
    .cashier-stat {
        text-align: center;
    }
    
    .cashier-stat-value {
        font-size: 1.25rem;
        font-weight: 800;
        color: #fff;
    }
    
    .cashier-stat-label {
        font-size: 0.6875rem;
        color: #94a3b8;
        text-transform: uppercase;
    }
    
    .best-badge {
        position: absolute;
        top: -8px;
        right: -8px;
        background: linear-gradient(135deg, #fbbf24 0%, #f59e0b 100%);
        color: #000;
        padding: 0.25rem 0.75rem;
        border-radius: 9999px;
        font-size: 0.6875rem;
        font-weight: 700;
        text-transform: uppercase;
        display: flex;
        align-items: center;
        gap: 0.25rem;
        box-shadow: 0 4px 12px rgba(251, 191, 36, 0.4);
    }
    
    .best-badge .material-symbols-outlined {
        font-size: 0.875rem;
    }
    
    .prep-time-display {
        display: flex;
        align-items: center;
        justify-content: center;
        gap: 1rem;
        padding: 1.5rem;
        background: linear-gradient(135deg, rgba(6, 182, 212, 0.1) 0%, rgba(99, 102, 241, 0.05) 100%);
        border: 1px solid rgba(6, 182, 212, 0.2);
        border-radius: 16px;
        margin-bottom: 1rem;
    }
    
    .prep-time-icon {
        width: 56px;
        height: 56px;
        border-radius: 14px;
        background: rgba(6, 182, 212, 0.15);
        display: flex;
        align-items: center;
        justify-content: center;
        color: #22d3ee;
        font-size: 1.75rem;
    }
    
    .prep-time-value {
        font-size: 2.5rem;
        font-weight: 800;
        color: #fff;
        letter-spacing: -0.02em;
    }
    
    .prep-time-unit {
        font-size: 1rem;
        color: #64748b;
        font-weight: 500;
    }
    
    .prep-time-label {
        font-size: 0.75rem;
        color: #94a3b8;
        margin-top: 0.25rem;
    }
    
    .order-type-grid {
        display: grid;
        grid-template-columns: repeat(3, 1fr);
        gap: 1rem;
        margin-bottom: 1rem;
    }
    
    .order-type-card {
        background: var(--glass-bg);
        border: 1px solid var(--glass-border);
        border-radius: 14px;
        padding: 1.25rem;
        text-align: center;
        transition: all 0.3s ease;
    }
    
    .order-type-card:hover {
        transform: translateY(-2px);
        border-color: rgba(255, 255, 255, 0.15);
    }
    
    .order-type-icon {
        width: 48px;
        height: 48px;
        border-radius: 12px;
        display: flex;
        align-items: center;
        justify-content: center;
        margin: 0 auto 0.75rem;
        font-size: 1.5rem;
    }
    
    .order-type-card.hall .order-type-icon {
        background: rgba(99, 102, 241, 0.15);
        color: #818cf8;
    }
    
    .order-type-card.delivery .order-type-icon {
        background: rgba(245, 158, 11, 0.15);
        color: #fbbf24;
    }
    
    .order-type-card.pickup .order-type-icon {
        background: rgba(16, 185, 129, 0.15);
        color: #34d399;
    }
    
    .order-type-count {
        font-size: 1.75rem;
        font-weight: 800;
        color: #fff;
        margin-bottom: 0.25rem;
    }
    
    .order-type-label {
        font-size: 0.75rem;
        color: #94a3b8;
        text-transform: uppercase;
        letter-spacing: 0.05em;
        margin-bottom: 0.5rem;
    }
    
    .order-type-revenue {
        font-size: 0.8125rem;
        color: #34d399;
        font-weight: 600;
    }
    
    .peak-hour-display {
        display: flex;
        align-items: center;
        gap: 1rem;
        padding: 1rem;
        background: linear-gradient(135deg, rgba(245, 158, 11, 0.1) 0%, rgba(249, 115, 22, 0.05) 100%);
        border: 1px solid rgba(245, 158, 11, 0.2);
        border-radius: 12px;
        margin-bottom: 1rem;
    }
    
    .peak-hour-icon {
        width: 48px;
        height: 48px;
        border-radius: 12px;
        background: rgba(245, 158, 11, 0.15);
        display: flex;
        align-items: center;
        justify-content: center;
        color: #fbbf24;
        font-size: 1.5rem;
    }
    
    .peak-hour-time {
        font-size: 1.5rem;
        font-weight: 800;
        color: #fbbf24;
    }
    
    .peak-hour-label {
        font-size: 0.75rem;
        color: #94a3b8;
    }
    
    .peak-hour-orders {
        font-size: 0.875rem;
        color: #64748b;
    }
    
    .empty-state {
        text-align: center;
        padding: 2rem 1rem;
        color: #64748b;
    }
    
    .empty-state .material-symbols-outlined {
        font-size: 2.5rem;
        margin-bottom: 0.75rem;
        opacity: 0.5;
    }
    
    .payment-progress {
        margin-top: 1rem;
    }
    
    .progress-bar {
        height: 8px;
        background: rgba(244, 63, 94, 0.2);
        border-radius: 4px;
        overflow: hidden;
        margin-bottom: 0.5rem;
    }
    
    .progress-fill {
        height: 100%;
        background: linear-gradient(90deg, #10b981, #34d399);
        border-radius: 4px;
        transition: width 1s ease;
    }
    
    .progress-labels {
        display: flex;
        justify-content: space-between;
        font-size: 0.75rem;
    }
    
    .progress-paid {
        color: #34d399;
        font-weight: 600;
    }
    
    .progress-unpaid {
        color: #fb7185;
        font-weight: 600;
    }
    
    .inkassa-card {
        background: rgba(0, 0, 0, 0.2);
        border-radius: 12px;
        padding: 1rem;
        margin-bottom: 0.75rem;
        border-left: 3px solid var(--primary);
    }
    
    .inkassa-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 0.5rem;
    }
    
    .inkassa-amount {
        font-size: 1.125rem;
        font-weight: 700;
        color: #fff;
    }
    
    .inkassa-type {
        padding: 0.25rem 0.5rem;
        border-radius: 6px;
        font-size: 0.6875rem;
        font-weight: 600;
        text-transform: uppercase;
    }
    
    .inkassa-type.cash {
        background: rgba(16, 185, 129, 0.15);
        color: #34d399;
    }
    
    .inkassa-type.uzcard {
        background: rgba(59, 130, 246, 0.15);
        color: #60a5fa;
    }
    
    .inkassa-meta {
        display: flex;
        justify-content: space-between;
        font-size: 0.75rem;
        color: #64748b;
    }
    
    .scrollable {
        max-height: 300px;
        overflow-y: auto;
    }
    
    .scrollable::-webkit-scrollbar {
        width: 6px;
    }
    
    .scrollable::-webkit-scrollbar-track {
        background: rgba(0, 0, 0, 0.1);
        border-radius: 3px;
    }
    
    .scrollable::-webkit-scrollbar-thumb {
        background: rgba(255, 255, 255, 0.1);
        border-radius: 3px;
    }
    
    .scrollable::-webkit-scrollbar-thumb:hover {
        background: rgba(255, 255, 255, 0.2);
    }
</style>

<div class="dashboard-container">
    <div class="dashboard-bg"></div>
    <div class="dashboard-content">
        
        <!-- Header -->
        <div class="dashboard-header">
            <div style="display: flex; justify-content: space-between; align-items: center; flex-wrap: wrap; gap: 1rem;">
                <div>
                    <h1 class="header-title">Smart Jowi Dashboard</h1>
                    <div class="header-subtitle">
                        <span class="material-symbols-outlined">schedule</span>
                        {{ current_time }}
                        <span class="timezone-badge">{{ timezone_label }}</span>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Filter Bar -->
        <div class="filter-bar">
            <div class="filter-group">
                {% for filter in filters %}
                <a href="{{ filter.link }}" class="filter-btn {% if filter.active %}active{% endif %}">
                    <span class="material-symbols-outlined">{{ filter.icon }}</span>
                    {{ filter.label }}
                </a>
                {% endfor %}
            </div>
            
            <div class="filter-divider"></div>
            
            <form id="dateFilterForm" method="get" class="date-inputs">
                <div class="date-input-group">
                    <label>From</label>
                    <input type="date" name="date_from" value="{{ date_from }}" class="date-input" onchange="this.form.submit()">
                    <input type="time" name="time_from" value="{{ time_from }}" class="date-input" step="60" onchange="this.form.submit()">
                </div>
                <span style="color: #64748b;">—</span>
                <div class="date-input-group">
                    <label>To</label>
                    <input type="date" name="date_to" value="{{ date_to }}" class="date-input" onchange="this.form.submit()">
                    <input type="time" name="time_to" value="{{ time_to }}" class="date-input" step="60" onchange="this.form.submit()">
                </div>
                {% if date_from or date_to %}
                <a href="?" class="clear-btn" title="Clear filters">
                    <span class="material-symbols-outlined">close</span>
                </a>
                {% endif %}
            </form>
        </div>
        
        <!-- Period Display -->
        <div class="period-display">
            <span class="material-symbols-outlined">date_range</span>
            <span class="period-label">{{ period_label }}</span>
        </div>
        
        <!-- KPI Cards -->
        <div class="kpi-grid">
            {% for kpi in kpis %}
            <div class="kpi-card {{ kpi.color }}">
                <div class="kpi-header">
                    <span class="kpi-title">{{ kpi.title }}</span>
                    <div class="kpi-icon">
                        <span class="material-symbols-outlined">{{ kpi.icon }}</span>
                    </div>
                </div>
                <div class="kpi-value">{{ kpi.metric }}<span class="kpi-unit">{{ kpi.unit }}</span></div>
                <div class="kpi-footer">
                    <span class="kpi-period">{{ kpi.footer }}</span>
                    {% if kpi.growth is not None %}
                    <span class="kpi-growth {% if kpi.growth >= 0 %}positive{% else %}negative{% endif %}">
                        <span class="material-symbols-outlined">{% if kpi.growth >= 0 %}trending_up{% else %}trending_down{% endif %}</span>
                        {{ kpi.growth|floatformat:1 }}%
                    </span>
                    {% endif %}
                </div>
            </div>
            {% endfor %}
        </div>
        
        <!-- Order Status Row -->
        <div class="status-row">
            {% for card in order_status_cards %}
            <div class="status-card {{ card.color }}">
                <div class="status-icon">
                    <span class="material-symbols-outlined">{{ card.icon }}</span>
                </div>
                <div class="status-count">{{ card.count }}</div>
                <div class="status-label">{{ card.title }}</div>
            </div>
            {% endfor %}
        </div>
        
        <!-- Charts Row 1: Product Pie & Category Pie -->
        <div class="chart-grid">
            <div class="chart-card">
                <div class="chart-header">
                    <h3 class="chart-title">
                        <span class="material-symbols-outlined">pie_chart</span>
                        Product Sales Distribution
                    </h3>
                    <span class="chart-badge violet">{{ total_items_sold }} items</span>
                </div>
                <div class="chart-container pie">
                    <canvas id="productPieChart"></canvas>
                </div>
                <div class="pie-legend" id="productLegend"></div>
            </div>
            
            <div class="chart-card">
                <div class="chart-header">
                    <h3 class="chart-title">
                        <span class="material-symbols-outlined">donut_small</span>
                        Revenue by Category
                    </h3>
                    <span class="chart-badge emerald">UZS</span>
                </div>
                <div class="chart-container pie">
                    <canvas id="categoryPieChart"></canvas>
                </div>
                <div class="pie-legend" id="categoryLegend"></div>
            </div>
        </div>
        
        <!-- Order Types Section -->
        <div class="chart-card full-width" style="margin-bottom: 1.5rem;">
            <div class="chart-header">
                <h3 class="chart-title">
                    <span class="material-symbols-outlined">local_shipping</span>
                    Order Types Distribution
                </h3>
            </div>
            <div class="order-type-grid">
                {% for key, data in order_type_stats.items %}
                <div class="order-type-card {% if key == 'HALL' %}hall{% elif key == 'DELIVERY' %}delivery{% else %}pickup{% endif %}">
                    <div class="order-type-icon">
                        <span class="material-symbols-outlined">
                            {% if key == 'HALL' %}restaurant{% elif key == 'DELIVERY' %}delivery_dining{% else %}takeout_dining{% endif %}
                        </span>
                    </div>
                    <div class="order-type-count">{{ data.count }}</div>
                    <div class="order-type-label">{{ data.label }}</div>
                    <div class="order-type-revenue">{{ data.revenue|floatformat:0 }} UZS</div>
                </div>
                {% endfor %}
            </div>
            <div class="chart-container" style="height: 200px;">
                <canvas id="orderTypeChart"></canvas>
            </div>
        </div>
        
        <!-- Charts Row 2: Revenue & Orders Trends -->
        <div class="chart-grid">
            <div class="chart-card">
                <div class="chart-header">
                    <h3 class="chart-title">
                        <span class="material-symbols-outlined">show_chart</span>
                        Revenue Trend
                    </h3>
                    <span class="chart-badge emerald">UZS</span>
                </div>
                <div class="chart-container">
                    <canvas id="revenueChart"></canvas>
                </div>
            </div>
            
            <div class="chart-card">
                <div class="chart-header">
                    <h3 class="chart-title">
                        <span class="material-symbols-outlined">analytics</span>
                        Orders Trend
                    </h3>
                    <span class="chart-badge blue">Count</span>
                </div>
                <div class="chart-container">
                    <canvas id="ordersChart"></canvas>
                </div>
            </div>
        </div>
        
        <!-- Growth & Hourly Charts -->
        <div class="chart-grid">
            <div class="chart-card">
                <div class="chart-header">
                    <h3 class="chart-title">
                        <span class="material-symbols-outlined">trending_up</span>
                        Weekly Growth
                    </h3>
                    <span class="chart-badge violet">4 weeks</span>
                </div>
                <div class="chart-container">
                    <canvas id="growthChart"></canvas>
                </div>
            </div>
            
            <div class="chart-card">
                <div class="chart-header">
                    <h3 class="chart-title">
                        <span class="material-symbols-outlined">schedule</span>
                        Hourly Distribution
                    </h3>
                </div>
                <div class="peak-hour-display">
                    <div class="peak-hour-icon">
                        <span class="material-symbols-outlined">local_fire_department</span>
                    </div>
                    <div>
                        <div class="peak-hour-label">Peak Hour</div>
                        <div class="peak-hour-time">{{ peak_hour.hour }}:00</div>
                        <div class="peak-hour-orders">{{ peak_hour.count }} orders</div>
                    </div>
                </div>
                <div class="chart-container" style="height: 200px;">
                    <canvas id="hourlyChart"></canvas>
                </div>
            </div>
        </div>
        
        <!-- Three Column Section -->
        <div class="three-col-grid">
            <!-- Cashier Performance -->
            <div class="chart-card">
                <div class="cashier-header">
                    <h3 class="chart-title">
                        <span class="material-symbols-outlined">badge</span>
                        Cashier Performance
                    </h3>
                    <form method="get">
                        <select name="cashier" class="cashier-select" onchange="this.form.submit()">
                            <option value="">All Cashiers</option>
                            {% for cashier in all_cashiers %}
                            <option value="{{ cashier.id }}" {% if selected_cashier == cashier.id|stringformat:"s" %}selected{% endif %}>
                                {{ cashier.first_name }} {{ cashier.last_name }}
                            </option>
                            {% endfor %}
                        </select>
                        {% if period %}<input type="hidden" name="period" value="{{ period }}">{% endif %}
                        {% if date_from %}<input type="hidden" name="date_from" value="{{ date_from }}">{% endif %}
                        {% if date_to %}<input type="hidden" name="date_to" value="{{ date_to }}">{% endif %}
                        {% if time_from %}<input type="hidden" name="time_from" value="{{ time_from }}">{% endif %}
                        {% if time_to %}<input type="hidden" name="time_to" value="{{ time_to }}">{% endif %}
                    </form>
                </div>
                
                {% if best_cashier %}
                <div class="cashier-card" style="position: relative;">
                    <div class="best-badge">
                        <span class="material-symbols-outlined">emoji_events</span>
                        Best Performer
                    </div>
                    <div class="cashier-avatar">{{ best_cashier.cashier__first_name|slice:":1" }}</div>
                    <div class="cashier-info">
                        <div class="cashier-name">{{ best_cashier.cashier__first_name }} {{ best_cashier.cashier__last_name }}</div>
                        <div class="cashier-role">Top Cashier</div>
                    </div>
                    <div class="cashier-stats">
                        <div class="cashier-stat">
                            <div class="cashier-stat-value">{{ best_cashier.order_count }}</div>
                            <div class="cashier-stat-label">Orders</div>
                        </div>
                        <div class="cashier-stat">
                            <div class="cashier-stat-value">{{ best_cashier.total_revenue|floatformat:0 }}</div>
                            <div class="cashier-stat-label">UZS</div>
                        </div>
                    </div>
                </div>
                {% endif %}
                
                <div class="scrollable">
                    <div class="data-table">
                        {% for cashier in cashier_performance %}
                        <div class="table-row">
                            <div class="table-main">
                                <div class="table-title">{{ cashier.cashier__first_name }} {{ cashier.cashier__last_name }}</div>
                                <div class="table-subtitle">{{ cashier.order_count }} orders · Hall: {{ cashier.hall_orders }} · Del: {{ cashier.delivery_orders }}</div>
                            </div>
                            <div class="table-value violet">{{ cashier.total_revenue|floatformat:0 }}</div>
                        </div>
                        {% empty %}
                        <div class="empty-state">
                            <span class="material-symbols-outlined">person_off</span>
                            <p>No cashier data</p>
                        </div>
                        {% endfor %}
                    </div>
                </div>
            </div>
            
            <!-- Top Products -->
            <div class="chart-card">
                <div class="chart-header">
                    <h3 class="chart-title">
                        <span class="material-symbols-outlined">inventory_2</span>
                        Top Products
                    </h3>
                </div>
                
                <div class="prep-time-display">
                    <div class="prep-time-icon">
                        <span class="material-symbols-outlined">timer</span>
                    </div>
                    <div>
                        <div class="prep-time-value">{{ avg_prep_time }}</div>
                        <div class="prep-time-label">Avg Prep Time</div>
                    </div>
                </div>
                
                <div class="scrollable">
                    <div class="data-table">
                        {% for product in top_products %}
                        <div class="table-row">
                            <div class="table-main">
                                <div class="table-title">{{ product.product__name }}</div>
                                <div class="table-subtitle">{{ product.total_quantity }} sold</div>
                            </div>
                            <div class="table-value emerald">{{ product.total_revenue|floatformat:0 }}</div>
                        </div>
                        {% empty %}
                        <div class="empty-state">
                            <span class="material-symbols-outlined">inventory_2</span>
                            <p>No products</p>
                        </div>
                        {% endfor %}
                    </div>
                </div>
            </div>
            
            <!-- Payment & Sessions -->
            <div class="chart-card">
                <div class="chart-header">
                    <h3 class="chart-title">
                        <span class="material-symbols-outlined">payments</span>
                        Payment Status
                    </h3>
                </div>
                
                <div class="payment-progress">
                    <div class="progress-bar">
                        <div class="progress-fill" style="width: {{ payment_status.paid_percentage }}%;"></div>
                    </div>
                    <div class="progress-labels">
                        <span class="progress-paid">{{ payment_status.paid }} Paid</span>
                        <span class="progress-unpaid">{{ payment_status.unpaid }} Unpaid</span>
                    </div>
                </div>
                
                <div style="margin-top: 1.5rem;">
                    <h4 class="chart-title" style="font-size: 0.9rem; margin-bottom: 1rem;">
                        <span class="material-symbols-outlined">receipt_long</span>
                        Recent Inkassa
                    </h4>
                    
                    <div class="scrollable" style="max-height: 180px;">
                        {% for inkassa in cashier_shifts %}
                        <div class="inkassa-card">
                            <div class="inkassa-header">
                                <span class="inkassa-amount">{{ inkassa.amount|floatformat:0 }} UZS</span>
                                <span class="inkassa-type {% if inkassa.inkass_type == 'CASH' %}cash{% else %}uzcard{% endif %}">
                                    {{ inkassa.inkass_type }}
                                </span>
                            </div>
                            <div class="inkassa-meta">
                                <span>{% if inkassa.cashier %}{{ inkassa.cashier.first_name }}{% else %}Unknown{% endif %}</span>
                                <span>{{ inkassa.created_at|date:"d.m H:i" }}</span>
                            </div>
                        </div>
                        {% empty %}
                        <div class="empty-state" style="padding: 1rem;">
                            <span class="material-symbols-outlined" style="font-size: 1.5rem;">receipt_long</span>
                            <p style="font-size: 0.75rem;">No inkassa</p>
                        </div>
                        {% endfor %}
                    </div>
                </div>
                
                <div style="margin-top: 1rem;">
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 0.75rem;">
                        <h4 class="chart-title" style="font-size: 0.9rem;">
                            <span class="material-symbols-outlined">person</span>
                            Sessions
                        </h4>
                        <span class="chart-badge emerald">{{ login_stats.active_sessions }} online</span>
                    </div>
                    
                    <div class="scrollable" style="max-height: 120px;">
                        <div class="data-table">
                            {% for login in recent_logins %}
                            <div class="table-row" style="padding: 0.5rem 0;">
                                <div class="table-main">
                                    <div class="table-title" style="font-size: 0.8125rem;">{{ login.name }}</div>
                                    <div class="table-subtitle">{{ login.last_login_at }}</div>
                                </div>
                            </div>
                            {% empty %}
                            <div class="empty-state" style="padding: 0.75rem;">
                                <p style="font-size: 0.75rem;">No logins</p>
                            </div>
                            {% endfor %}
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
    </div>
</div>

<!-- Chart Data -->
<script id="product-pie-data" type="application/json">{{ product_pie_json|safe }}</script>
<script id="category-pie-data" type="application/json">{{ category_pie_json|safe }}</script>
<script id="order-type-data" type="application/json">{{ order_type_chart_json|safe }}</script>
<script id="revenue-data" type="application/json">{{ revenue_chart_json|safe }}</script>
<script id="orders-data" type="application/json">{{ orders_chart_json|safe }}</script>
<script id="growth-data" type="application/json">{{ growth_chart_json|safe }}</script>
<script id="hourly-data" type="application/json">{{ hourly_chart_json|safe }}</script>

<script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
<script>
document.addEventListener('DOMContentLoaded', function() {
    
    Chart.defaults.color = '#94a3b8';
    Chart.defaults.borderColor = 'rgba(255, 255, 255, 0.05)';
    Chart.defaults.font.family = "'Plus Jakarta Sans', sans-serif";
    
    const formatNumber = (num) => {
        if (num >= 1000000) return (num / 1000000).toFixed(1) + 'M';
        if (num >= 1000) return (num / 1000).toFixed(0) + 'K';
        return num.toString();
    };
    
    // Product Pie Chart
    const productPieCtx = document.getElementById('productPieChart');
    if (productPieCtx) {
        try {
            const productData = JSON.parse(document.getElementById('product-pie-data').textContent);
            
            new Chart(productPieCtx, {
                type: 'doughnut',
                data: {
                    labels: productData.labels,
                    datasets: [{
                        data: productData.data,
                        backgroundColor: productData.colors,
                        borderColor: 'rgba(0, 0, 0, 0.3)',
                        borderWidth: 2,
                        hoverBorderColor: '#fff',
                        hoverBorderWidth: 3,
                        hoverOffset: 10,
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    cutout: '65%',
                    plugins: {
                        legend: { display: false },
                        tooltip: {
                            backgroundColor: 'rgba(15, 23, 42, 0.95)',
                            padding: 16,
                            cornerRadius: 12,
                            callbacks: {
                                label: function(ctx) {
                                    const percentage = productData.percentages[ctx.dataIndex];
                                    const revenue = productData.revenue[ctx.dataIndex];
                                    return [
                                        `Qty: ${ctx.raw} (${percentage}%)`,
                                        `Rev: ${formatNumber(revenue)} UZS`
                                    ];
                                }
                            }
                        }
                    },
                    animation: { animateRotate: true, animateScale: true, duration: 1000 }
                }
            });
            
            const legendContainer = document.getElementById('productLegend');
            if (legendContainer && productData.labels.length > 0) {
                legendContainer.innerHTML = productData.labels.slice(0, 6).map((label, i) => `
                    <div class="legend-item">
                        <div class="legend-color" style="background: ${productData.colors[i]}"></div>
                        <span class="legend-label">${label}</span>
                        <span class="legend-value">${productData.percentages[i]}%</span>
                    </div>
                `).join('');
            }
        } catch (e) { console.error('Product pie error:', e); }
    }
    
    // Category Pie Chart
    const categoryPieCtx = document.getElementById('categoryPieChart');
    if (categoryPieCtx) {
        try {
            const categoryData = JSON.parse(document.getElementById('category-pie-data').textContent);
            
            new Chart(categoryPieCtx, {
                type: 'doughnut',
                data: {
                    labels: categoryData.labels,
                    datasets: [{
                        data: categoryData.data,
                        backgroundColor: categoryData.colors,
                        borderColor: 'rgba(0, 0, 0, 0.3)',
                        borderWidth: 2,
                        hoverOffset: 10,
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    cutout: '65%',
                    plugins: {
                        legend: { display: false },
                        tooltip: {
                            backgroundColor: 'rgba(15, 23, 42, 0.95)',
                            padding: 16,
                            cornerRadius: 12,
                            callbacks: {
                                label: function(ctx) {
                                    const percentage = categoryData.percentages[ctx.dataIndex];
                                    return `${formatNumber(ctx.raw)} UZS (${percentage}%)`;
                                }
                            }
                        }
                    },
                    animation: { duration: 1200 }
                }
            });
            
            const catLegend = document.getElementById('categoryLegend');
            if (catLegend && categoryData.labels.length > 0) {
                catLegend.innerHTML = categoryData.labels.slice(0, 6).map((label, i) => `
                    <div class="legend-item">
                        <div class="legend-color" style="background: ${categoryData.colors[i]}"></div>
                        <span class="legend-label">${label}</span>
                        <span class="legend-value">${formatNumber(categoryData.data[i])}</span>
                    </div>
                `).join('');
            }
        } catch (e) { console.error('Category pie error:', e); }
    }
    
    // Order Type Chart
    const orderTypeCtx = document.getElementById('orderTypeChart');
    if (orderTypeCtx) {
        try {
            const orderTypeData = JSON.parse(document.getElementById('order-type-data').textContent);
            
            new Chart(orderTypeCtx, {
                type: 'bar',
                data: {
                    labels: orderTypeData.labels,
                    datasets: [{
                        data: orderTypeData.data,
                        backgroundColor: orderTypeData.colors.map(c => c + '80'),
                        borderColor: orderTypeData.colors,
                        borderWidth: 2,
                        borderRadius: 8,
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: { legend: { display: false } },
                    scales: {
                        y: { beginAtZero: true, grid: { color: 'rgba(255, 255, 255, 0.03)' } },
                        x: { grid: { display: false } }
                    }
                }
            });
        } catch (e) { console.error('Order type error:', e); }
    }
    
    // Revenue Chart
    const revenueCtx = document.getElementById('revenueChart');
    if (revenueCtx) {
        try {
            const revenueData = JSON.parse(document.getElementById('revenue-data').textContent);
            new Chart(revenueCtx, {
                type: 'line',
                data: revenueData,
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    interaction: { intersect: false, mode: 'index' },
                    plugins: {
                        legend: { display: false },
                        tooltip: {
                            backgroundColor: 'rgba(15, 23, 42, 0.95)',
                            padding: 14,
                            cornerRadius: 10,
                            callbacks: { label: (ctx) => formatNumber(ctx.parsed.y) + ' UZS' }
                        }
                    },
                    scales: {
                        y: { beginAtZero: true, grid: { color: 'rgba(255, 255, 255, 0.03)' }, ticks: { callback: (v) => formatNumber(v) } },
                        x: { grid: { display: false } }
                    }
                }
            });
        } catch (e) { console.error('Revenue error:', e); }
    }
    
    // Orders Chart
    const ordersCtx = document.getElementById('ordersChart');
    if (ordersCtx) {
        try {
            const ordersData = JSON.parse(document.getElementById('orders-data').textContent);
            new Chart(ordersCtx, {
                type: 'line',
                data: ordersData,
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    interaction: { intersect: false, mode: 'index' },
                    plugins: { legend: { display: false } },
                    scales: {
                        y: { beginAtZero: true, grid: { color: 'rgba(255, 255, 255, 0.03)' }, ticks: { stepSize: 1 } },
                        x: { grid: { display: false } }
                    }
                }
            });
        } catch (e) { console.error('Orders error:', e); }
    }
    
    // Growth Chart
    const growthCtx = document.getElementById('growthChart');
    if (growthCtx) {
        try {
            const growthData = JSON.parse(document.getElementById('growth-data').textContent);
            new Chart(growthCtx, {
                type: 'bar',
                data: {
                    labels: growthData.labels,
                    datasets: [
                        {
                            label: 'Revenue',
                            data: growthData.revenue,
                            backgroundColor: 'rgba(139, 92, 246, 0.6)',
                            borderColor: '#8b5cf6',
                            borderWidth: 2,
                            borderRadius: 6,
                            yAxisID: 'y',
                        },
                        {
                            label: 'Orders',
                            data: growthData.orders,
                            type: 'line',
                            borderColor: '#f59e0b',
                            backgroundColor: 'rgba(245, 158, 11, 0.1)',
                            tension: 0.4,
                            fill: true,
                            yAxisID: 'y1',
                            pointRadius: 5,
                            pointBackgroundColor: '#f59e0b',
                        }
                    ]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: { display: true, position: 'top', labels: { usePointStyle: true, padding: 15 } }
                    },
                    scales: {
                        y: { type: 'linear', position: 'left', beginAtZero: true, grid: { color: 'rgba(255, 255, 255, 0.03)' }, ticks: { callback: (v) => formatNumber(v) } },
                        y1: { type: 'linear', position: 'right', beginAtZero: true, grid: { drawOnChartArea: false } },
                        x: { grid: { display: false } }
                    }
                }
            });
        } catch (e) { console.error('Growth error:', e); }
    }
    
    // Hourly Chart
    const hourlyCtx = document.getElementById('hourlyChart');
    if (hourlyCtx) {
        try {
            const hourlyData = JSON.parse(document.getElementById('hourly-data').textContent);
            const maxOrders = Math.max(...hourlyData.data);
            const bgColors = hourlyData.data.map(v => v === maxOrders && v > 0 ? 'rgba(245, 158, 11, 0.8)' : 'rgba(99, 102, 241, 0.5)');
            
            new Chart(hourlyCtx, {
                type: 'bar',
                data: {
                    labels: hourlyData.labels,
                    datasets: [{ data: hourlyData.data, backgroundColor: bgColors, borderRadius: 4 }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: { legend: { display: false } },
                    scales: {
                        y: { beginAtZero: true, grid: { color: 'rgba(255, 255, 255, 0.03)' } },
                        x: { grid: { display: false }, ticks: { maxRotation: 0, callback: function(v, i) { return i % 3 === 0 ? this.getLabelForValue(v) : ''; } } }
                    }
                }
            });
        } catch (e) { console.error('Hourly error:', e); }
    }
    
    // Animate progress bar
    const progressFill = document.querySelector('.progress-fill');
    if (progressFill) {
        const targetWidth = progressFill.style.width;
        progressFill.style.width = '0%';
        setTimeout(() => { progressFill.style.width = targetWidth; }, 500);
    }
});
</script>

{% endblock %}